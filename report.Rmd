---
title: |
  <br>**International Women's Day Special Report - Women's Legal Rights**
author: |
  | Author: Mengyun Yang 
  | Supervisor: James Goldie at 360info
date: "16/12/2021"
output: 
  bookdown::html_document2:
    css: "style.css"
    includes:
      before_body: women.html #https://www.commonwealthclub.org/events/2020-05-21/empowering-women-climate-solution-we-dont-talk-about
    toc: yes
    toc_depth: 1
    toc_float:
      collapsed: false
    number_sections: false
    # code_folding: show
    theme: cosmo
bibliography: references.bib  
---

```{r setup, include = FALSE, echo = FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  error = FALSE, 
  collapse = TRUE,
  comment = "#",
  # fig.height = 4,
  # fig.width = 8,
  fig.align = "center",
  cache = FALSE
  )
```

```{r packages, include = FALSE, echo = FALSE, message = FALSE, warning = FALSE}
library(tidyverse)
library(skimr)
library(janitor)
library(glue)
library(ggplot2); ggplot2::theme_set(theme_minimal())
library(here)
library(readxl)
library(stringr)
library(scales)
library(forcats)
library(plotly)
library(tmap)
library(sf)
library(leaflet)
library(shiny)
library(ggthemes)
library(kableExtra)
library(gt)
library(ggpubr)
library(ggflags)
library(countrycode)
library(themes360info)
library(grid)
library(rsvg)
library(ggrepel)
```


```{r wbl}
# downloaded from https://wbl.worldbank.org/en/wbl-data
wbl_df <- read_xlsx(here("data/WBL1971-2022 Dataset.xlsx"), sheet = 2) 

# cleaning 
wbl_df <- clean_names(wbl_df) 
```

```{r gender}
# downloaded from https://data.worldbank.org/topic/gender
## skip the first 4 rows
gender <- read.csv(here("data/API_17_DS2_en_csv_v2_4040307/API_17_DS2_en_csv_v2_4040307.csv"), skip = 4) 


```

```{r gender-gap-index}
# downloaded from: https://tcdata360.worldbank.org/indicators/af52ebe9?country=BRA&indicator=27959&viz=line_chart&years=2006,2021
gap <- read_csv(here("data/gender_gap_index.csv"))

# cleaning 
gap <- clean_names(gap) 

names(gap) <- sub("x", "", names(gap))

```


```{r vdem}
# downloaded from https://www.v-dem.net/vdemds.html
vdem <- readRDS(here("data/V-Dem-CY-Full+Others-v11.1.rds"))

```

# Abstract


# Background
For the past 47 years, International Women's Day has been celebrated worldwide on the 8th of March. It honours women's social, economic, cultural, and political achievements. The day also serves as a rallying cry for greater gender equality. Although the past decades have been significant progress for women's and girls' rights. Overall, though, progress has been uneven and slow. The worldwide gender gap will not close for another 100 years at the current rate of progress [@UnitedNations]. This analysis aims to identify the bias in the creation of laws which can disadvantage women - both socially and economically.


# Objectives 



# Methodology



# Data sources

The data used in this project consists of 4 separate data set. The women, business and the law data, gender gap index data and gender indicator data were all obtained from open data source The World Bank Data's [Women, Business and the Law Data Portal](https://wbl.worldbank.org/en/wbl-data), [Overall Global Gender Gap Index Portal](https://tcdata360.worldbank.org/indicators/af52ebe9?country=BRA&indicator=27959&viz=line_chart&years=2006,2021) and [Gender Portal](https://data.worldbank.org/topic/gender) respectively. The democracy ratings data is also an open data that sourced from [V-Dem (Varieties of Democracy by University of Gothenburg)](https://www.v-dem.net/vdemds.html).

## The women, business and the law data
The women, business and the law data set contains 10 sheets of data. It assesses the economic empowerment of women. It is based on the countries' formal laws and regulations that have a bearing on women's economic participation, covering eight areas such as mobility, workplace, pay, marriage, parenthood, entrepreneurship, assets and pension. It tracks how laws affect women at different stages in their working lives and focusing on those laws applicable in the main business city [@civilsdaily]. The first two sheets are overall WBL index scores, individual indicator scores go evaluate 35 parts of the law from 190 economies from years 1971 to 2021. The subsequent sheets present answer for the scored questions by 8 indicators. Indicator-level scores are obtained by calculating the unweighed average of the questions within that indicator and scaling the result to 100. Overall scores are then calculated by taking the average of each indicator, with 100 representing the highest possible score, a higher score suggests that there are more laws promoting gender equality [@WBL] (see Table \@ref(tab:wbl-data) for scoring method for WBL data). There are no missing values presented in this data set.

```{r wbl-data}
tribble(
  ~Score, ~Range,
  "WBL Index",   "0 - 100",
  "Indicator Score",   "0 - 100",
  "Answer to Scored Question",    "Yes/No",
  "Answer Score", "1(Yes)/0(No)"
) %>% 
  kable(caption = "Scoring method for WBL data") %>% 
  kable_styling(full_width = FALSE) %>% 
  footnote(general = "The World Bank",
           general_title = "Source:",
           footnote_as_chunk = TRUE)

```

## The gender index data
Gender equality is critical to the success of economies and communities. Ensuring the full development and effective deployment of half of the world's entire talent pool has a significant impact on global economic growth, competitiveness, and future-readiness. The Index is more concerned with measuring gaps than with assessing levels. Second, rather than gaps in input data, it captures gaps in outcome variables. Third, rather than focusing on women's empowerment, it rates countries based on gender equality. Economic Participation and Opportunity, Educational Attainment, Health and Survival and Political Empowerment are the four core categories (sub-indexes) that the Global Gender Gap Index covers [@gap]. This data set contains `r length(unique(gap$indicator))` indicators under this four core categories for measuring gender gap across `r length(unique(gap$country_name))` countries from 2006 - 2021, see Table \@ref(tab:gender-index) for explanation of the variable used in this analysis.

```{r gender-index}
tribble(
  ~INDICATOR, ~TYPE, ~RANGE, ~CLARIFICATION, 
  "Overall Global Gender Gap Index", "Index", "0 - 1", "The highest possible score is 1 (equality) and the lowest possible score is 0 (inequality)."
) %>% 
  kable(caption = "Codebook for gender gap index data") %>% 
  kable_styling(full_width = FALSE) %>% 
  footnote(general = "The World Bank",
           general_title = "Source:",
           footnote_as_chunk = TRUE)
```






## The gender indicator data

There are `r nrow(gender)` observations and `r ncol(gender)` columns in the gender indicator data set. It contains collection of data on `r nrow(read_csv(here("data/API_17_DS2_en_csv_v2_4040307/Metadata_Indicator_API_17_DS2_en_csv_v2_4040307.csv")))-1` significant gender issues such as education, employment, health, population etc. for period from 1960 to 2021 (see Table \@ref(tab:gender-metadata) for metadata of the gender indicator). As it can be seen from Table \@ref(tab:gender-data), there are a lot of missing values in this data set, not all the indicators have data for the whole period of 1960 to 2021. However, there were only one indicator used in this analysis for period from 1997 - 2021, therefore, missing values can be omitted.

```{r gender-data}
skim(gender %>% select(-X)) %>% 
  kable(caption = "Summary of missing value of gender indicator data frame (scrollable)") %>% 
  kable_styling(full_width = TRUE) %>% 
  scroll_box(height = "200px")
```
<br>

```{r gender-metadata}
read_csv(here("data/API_17_DS2_en_csv_v2_4040307/Metadata_Indicator_API_17_DS2_en_csv_v2_4040307.csv")) %>% 
  select(-...5) %>%
  kable(caption = "Codebook of gender indicator (scrollable)") %>% 
  kable_styling(full_width = TRUE) %>% 
  scroll_box(height = "400px") %>% 
  footnote(general = "The World Bank",
           general_title = "Source:",
          footnote_as_chunk = TRUE)
```


## The democracy ratings data 
This data set contains 483 V-Dam indicator and indices and 59 others indicators from other data sources that measure the complexity of the concept of democracy as a system of rule that goes beyond the simple presence of elections [@vdem]. Only a indicator  was used in this analysis for assessing women's suffrage. There are missing values in this indicator which represent the no direct national elections, see Table \@ref(tab:vdem_missing) for details of the missing values in the subset and Table \@ref(tab:vdem-metadata) for metadata of the dataset.


```{r vdem-metadata}
tribble(
  ~INDICATOR, ~QUESTION, ~CLARIFICATION, ~RESPONSES, 
  "v2elfemrst",   "Are women eligible to vote in national elections", "If there are no (direct) national elections, observations are not coded (missing)", "0: No female suffrage. No women are allowed to vote, but some or all males vote. \n1: Restricted female suffrage. Some women are allowed to vote, and face more or different restrictions than men. \n2: Universal female suffrage. All women are allowed to vote.") %>% 
#   "v2clacjstw", "Do women enjoy equal, secure, and effective access to justice?", "This question specifies the extent to which women can bring cases before the courts without risk to their personal safety, trials are fair, and women have effective ability to seek redress if public authorities violate their rights, including the rights to counsel, defense, and
# appeal.", "0: Secure and effective access to justice for women is non-existent.
# 1: Secure and effective access to justice for women is usually not established or widely respected.
# 2: Secure and effective access to justice for women is inconsistently observed. Minor problems
# characterize most cases or occur rather unevenly across different parts of the country.
# 3: Secure and effective access to justice for women is usually observed.
# 4: Secure and effective access to justice for women is almost always observed.") %>% 
  kable(caption = "Codebook for the democracy ratings data") %>% 
  kable_styling() %>% 
    footnote(general = "V-Dem",
             general_title = "Source:",
             footnote_as_chunk = TRUE)
```

<br>

```{r vdem-missing}
vdem %>% 
  select(v2elfemrst) %>% 
         #v2clacjstw) %>% 
  skim() %>% 
  kable(caption = "Summary of missing values of the subset of democracy ratings data") %>% 
  kable_styling()
```

# Result and discussion

## The Women, Business and the Law index

The Women, Business, and the Law Index assesses global progress towards gender equality in 190 economies by identifying laws and regulations that limit and encourage women's economic participation [@WBL]. As it can be seen from Figure \@ref(fig:wbl-average), there has been continuous progress being made on the laws that help improve women's legal rights. Over the 5 decades, the WBL index has increased substantially, from 45.6 to 76.5. Despite these gains, there is still room for improvement. Women are still far from being equal with men and many challenges remain, such as discriminatory laws and social norms remain pervasive, women continue to be underrepresented at all levels of political leadership, 1 in 5 women and girls between the ages of 15 and 49 report experiencing physical or sexual violence by an intimate partner within a 12-month period or underpaid compared to males in part-time occupations or informal labour sector with minimal security and limited rights [@UnitedNations2]. 

```{r wbl-average, fig.cap="The trend of the global average Women, Business and the Law score of 190 economics."}
wbl_average <- wbl_df %>% 
  select(report_year, wbl_index) %>% 
  group_by(report_year) %>% 
  summarise(wbl = mean(wbl_index)) %>% 
  ungroup() 
  
  
wbl_average$tooltip <- 
  glue_data(wbl_average,
            "Year: {report_year}",
            "\nWBL index: {round(wbl, 1)}")

ggplotly(
  
wbl_average %>% 
  ggplot(aes(x = report_year,
             y = wbl,
             group = 1)) + 
  geom_line(aes(text = tooltip),
            size = 0.8,
            color = "Salmon2") +
  geom_point(aes(text = tooltip),
             size = 1.2,
             color = "Salmon2") +
  labs(x = "Year",
       y = "WBL index",
       title = "The global average Women, Business and the Law score"),
tooltip = "text"

) %>% 
    layout(annotations = list(x = 0.1, 
                              y = -0.1, 
                              text = "Source: The World Bank",
                              showarrow = FALSE, 
                              xref = "paper", 
                              yref = "paper",
                              xanchor = "right", 
                              yanchor = "auto", 
                              xshift = 0, 
                              yshift = 0,
                              font = list(size = 8)
)) %>% 
  config(displayModeBar = FALSE,
         displaylogo = FALSE) 
```


```{r wbl-shiny}
# faceted choropleth map
wbl_index_map <- wbl_df %>% 
  select(economy, iso_code, report_year, wbl_index)


## get geometry for each country
data("World")

coords <- World %>% 
  select("iso_a3",
         "name",
         "geometry") %>% 
  rename(iso_code = "iso_a3")


## join spatial df with wbl_df
wbl_index_map <- wbl_index_map %>% 
  left_join(coords,
            by = "iso_code") %>% 
  drop_na() %>% 
  st_as_sf() 


## add tooltip
wbl_index_map$tooltip <- 
  glue_data(wbl_index_map,
            "Country: {economy}",
            "\nPercentage: {wbl_index}")



## shiny app
shinyApp(
  
ui <- fluidPage(
  sliderInput("range",
              "year",
              min = min(wbl_index_map$report_year),
              max = max(wbl_index_map$report_year),
              value = min(wbl_index_map$report_year),
              step = 1,
              sep = ""),
  leafletOutput("wblmap")
),


server <- function(input, output, session) {
  
  map_years <- reactive({
    wbl_index_map_year <- wbl_index_map %>%
      filter(report_year == input$range)

  })

output$wblmap <- renderLeaflet({
  
  palette <- colorBin(palette = "viridis",
                      domain = map_years()$wbl_index,
                      bins = 5,
                      na.color ="transparent",
                      reverse = TRUE)

  text <- paste("Country:", map_years()$economy, 
              "<br> Year:", map_years()$report_year, 
              "<br> WBL index:", map_years()$wbl_index) %>%
  lapply(htmltools::HTML)
  
  
 map_years() %>%
    leaflet() %>%
    setView(lat = 30, lng = 0, zoom = 1) %>%
    addTiles() %>%
    addPolygons(
      fillColor = ~ palette(map_years()$wbl_index),
      weight = 0.5,
      opacity = 1,
      color = "white",
      smoothFactor = 0.2,
      fillOpacity = 1,
      label = text,
    highlight = highlightOptions(
      color = "#666",
      weight = 2,
      bringToFront = TRUE,
      opacity = 1)
    ) %>%
    addLegend(
      pal = palette,
      values = map_years()$wbl_index,
      opacity = 0.7,
      title = "WBL Index",
      position = "bottomleft",
      labFormat = labelFormat(transform = function(x) sort(x, decreasing = TRUE))
      ) 
})

},

  options = list(height = 500)
)
```



# Conclusion


# Reference



